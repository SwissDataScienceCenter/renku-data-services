# generated by datamodel-codegen:
#   filename:  api.spec.yaml
#   timestamp: 2026-02-18T10:15:16+00:00

from __future__ import annotations

from datetime import date, time
from enum import Enum
from typing import List, Optional

from pydantic import ConfigDict, Field, RootModel
from renku_data_services.capacity_reservation.apispec_base import BaseAPISpec


class RecurrenceType(Enum):
    once = "once"
    daily = "daily"
    weekly = "weekly"


class ScaleDownBehavior(Enum):
    maintain = "maintain"
    reduce = "reduce"


class ScheduleEntry(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    day_of_week: int = Field(..., examples=[1], ge=1, le=7)
    start_time: time = Field(..., examples=["08:00:00"])
    end_time: time = Field(..., examples=["18:00:00"])


class RecurrenceConfig(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    type: RecurrenceType
    start_date: date = Field(..., examples=["2026-01-15"])
    end_date: date = Field(..., examples=["2026-06-15"])
    schedule: List[ScheduleEntry] = []


class ProvisioningConfig(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    placeholder_count: int = Field(..., examples=[10], ge=1)
    cpu_request: str = Field(..., examples=["1"])
    memory_request: str = Field(..., examples=["2Gi"])
    priority_class_name: Optional[str] = Field(
        None, examples=["renku-capacity-reservation"]
    )
    lead_time_minutes: int = Field(..., examples=[30], ge=0, le=180)
    scale_down_behavior: ScaleDownBehavior


class MatchingConfig(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    project_template_id: Optional[str] = Field(
        None, examples=["01ARZ3NDEKTSV4RRFFQ69G5FAV"]
    )
    resource_class_id: Optional[int] = Field(None, examples=[42])


class CapacityReservationPost(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    name: str = Field(..., examples=["Monday Morning Course"], max_length=40)
    recurrence: RecurrenceConfig
    provisioning: ProvisioningConfig
    matching: MatchingConfig


class CapacityReservation(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: str = Field(
        ...,
        description="ULID identifier",
        max_length=26,
        min_length=26,
        pattern="^[0-7][0-9A-HJKMNP-TV-Z]{25}$",
    )
    name: str = Field(..., examples=["Monday Morning Course"], max_length=40)
    recurrence: RecurrenceConfig
    provisioning: ProvisioningConfig
    matching: MatchingConfig


class CapacityReservationList(RootModel[List[CapacityReservation]]):
    root: List[CapacityReservation]


class CapacityReservationGetParameters(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: Optional[str] = Field(
        None,
        description="ULID identifier",
        max_length=26,
        min_length=26,
        pattern="^[0-7][0-9A-HJKMNP-TV-Z]{25}$",
    )
    name: Optional[str] = None


class Error(BaseAPISpec):
    code: int = Field(..., examples=[1404], gt=0)
    detail: Optional[str] = Field(
        None, examples=["A more detailed optional message showing what the problem was"]
    )
    message: str = Field(
        ..., examples=["Something went wrong - please try again later"]
    )


class ErrorResponse(BaseAPISpec):
    error: Error


class CapacityReservationsGetParametersQuery(BaseAPISpec):
    parameters: Optional[CapacityReservationGetParameters] = None
