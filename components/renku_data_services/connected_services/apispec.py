# generated by datamodel-codegen:
#   filename:  api.spec.yaml
#   timestamp: 2025-09-05T09:24:07+00:00

from __future__ import annotations

from datetime import datetime
from enum import Enum
from typing import List, Optional

from pydantic import ConfigDict, Field, RootModel
from renku_data_services.connected_services.apispec_base import BaseAPISpec


class RepositorySelection(Enum):
    all = "all"
    selected = "selected"


class AppInstallation(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: int
    account_login: str
    account_web_url: str
    repository_selection: RepositorySelection
    suspended_at: Optional[datetime] = None


class ProviderKind(Enum):
    gitlab = "gitlab"
    github = "github"
    drive = "drive"
    onedrive = "onedrive"
    dropbox = "dropbox"
    generic_oidc = "generic_oidc"


class ConnectionStatus(Enum):
    connected = "connected"
    pending = "pending"


class PaginationRequest(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    page: int = Field(1, description="Result's page number starting from 1", ge=1)
    per_page: int = Field(
        20, description="The number of results per page", ge=1, le=100
    )


class Error(BaseAPISpec):
    code: int = Field(..., examples=[1404], gt=0)
    detail: Optional[str] = Field(
        None, examples=["A more detailed optional message showing what the problem was"]
    )
    message: str = Field(
        ..., examples=["Something went wrong - please try again later"]
    )


class ErrorResponse(BaseAPISpec):
    error: Error


class AuthorizeParams(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    next_url: Optional[str] = Field(
        None,
        description="The URL to redirect the user to once the authorization flow has been completed.",
    )


class Oauth2ProvidersProviderIdAuthorizeGetParametersQuery(BaseAPISpec):
    authorize_params: Optional[AuthorizeParams] = None


class Oauth2ConnectionsConnectionIdInstallationsGetParametersQuery(BaseAPISpec):
    params: Optional[PaginationRequest] = None


class Provider(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: str = Field(
        ...,
        description='ID of a OAuth2 provider, e.g. "gitlab.com".',
        examples=["some-id"],
    )
    kind: ProviderKind
    app_slug: str = Field(
        ...,
        description="URL-friendly name of the application. This field only applies to\nGitHub Applications. The slug is provided by GitHub when\nsetting up a GitHub App.\n",
        examples=["my-application"],
    )
    client_id: str = Field(
        ...,
        description="Client ID or Application ID value. This is provided by\nthe Resource Server when setting up a new OAuth2 Client.\n",
        examples=["some-client-id"],
    )
    client_secret: Optional[str] = Field(
        None,
        description="Client secret provided by the Resource Server when setting\nup a new OAuth2 Client.\n",
        examples=["some-client-secret"],
    )
    display_name: str = Field(..., examples=["my oauth2 application"])
    scope: str = Field(..., examples=["api"])
    url: str = Field(
        ...,
        description='The base URL of the OAuth2 Resource Server, e.g. "https://gitlab.com".\n',
        examples=["https://example.org"],
    )
    use_pkce: bool = Field(
        ...,
        description="Whether or not to use PKCE during authorization flows.\n",
        examples=[False],
    )
    image_registry_url: Optional[str] = Field(
        None,
        description="This should contain no paths, just the domain for the registry and the scheme\n(http or https) to access the image registry API.\n",
        examples=["https://registry.gitlab.com"],
    )


class ProviderPost(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: str = Field(
        ...,
        description='ID of a OAuth2 provider, e.g. "gitlab.com".',
        examples=["some-id"],
    )
    kind: ProviderKind
    app_slug: Optional[str] = Field(
        None,
        description="URL-friendly name of the application. This field only applies to\nGitHub Applications. The slug is provided by GitHub when\nsetting up a GitHub App.\n",
        examples=["my-application"],
    )
    client_id: str = Field(
        ...,
        description="Client ID or Application ID value. This is provided by\nthe Resource Server when setting up a new OAuth2 Client.\n",
        examples=["some-client-id"],
    )
    client_secret: Optional[str] = Field(
        None,
        description="Client secret provided by the Resource Server when setting\nup a new OAuth2 Client.\n",
        examples=["some-client-secret"],
    )
    display_name: str = Field(..., examples=["my oauth2 application"])
    scope: str = Field(..., examples=["api"])
    url: str = Field(
        ...,
        description='The base URL of the OAuth2 Resource Server, e.g. "https://gitlab.com".\n',
        examples=["https://example.org"],
    )
    use_pkce: Optional[bool] = Field(
        False,
        description="Whether or not to use PKCE during authorization flows.\n",
        examples=[False],
    )
    image_registry_url: Optional[str] = Field(
        None,
        description="This should contain no paths, just the domain for the registry and the scheme\n(http or https) to access the image registry API.\n",
        examples=["https://registry.gitlab.com"],
    )


class ProviderPatch(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    kind: Optional[ProviderKind] = None
    app_slug: Optional[str] = Field(
        None,
        description="URL-friendly name of the application. This field only applies to\nGitHub Applications. The slug is provided by GitHub when\nsetting up a GitHub App.\n",
        examples=["my-application"],
    )
    client_id: Optional[str] = Field(
        None,
        description="Client ID or Application ID value. This is provided by\nthe Resource Server when setting up a new OAuth2 Client.\n",
        examples=["some-client-id"],
    )
    client_secret: Optional[str] = Field(
        None,
        description="Client secret provided by the Resource Server when setting\nup a new OAuth2 Client.\n",
        examples=["some-client-secret"],
    )
    display_name: Optional[str] = Field(None, examples=["my oauth2 application"])
    scope: Optional[str] = Field(None, examples=["api"])
    url: Optional[str] = Field(
        None,
        description='The base URL of the OAuth2 Resource Server, e.g. "https://gitlab.com".\n',
        examples=["https://example.org"],
    )
    use_pkce: Optional[bool] = Field(
        False,
        description="Whether or not to use PKCE during authorization flows.\n",
        examples=[False],
    )
    image_registry_url: Optional[str] = Field(
        None,
        description="This should contain no paths, just the domain for the registry and the scheme\n(http or https) to access the image registry API.\n",
        examples=["https://registry.gitlab.com"],
    )


class Connection(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    id: str = Field(
        ...,
        description="ULID identifier",
        max_length=26,
        min_length=26,
        pattern="^[0-7][0-9A-HJKMNP-TV-Z]{25}$",
    )
    provider_id: str = Field(
        ...,
        description='ID of a OAuth2 provider, e.g. "gitlab.com".',
        examples=["some-id"],
    )
    status: ConnectionStatus


class ConnectedAccount(BaseAPISpec):
    model_config = ConfigDict(
        extra="forbid",
    )
    username: str = Field(..., examples=["some-username"])
    web_url: str = Field(
        ...,
        description="A URL which can be opened in a browser, i.e. a web page.",
        examples=["https://example.org"],
    )


class AppInstallationList(RootModel[List[AppInstallation]]):
    root: List[AppInstallation]


class ProviderList(RootModel[List[Provider]]):
    root: List[Provider]


class ConnectionList(RootModel[List[Connection]]):
    root: List[Connection]
