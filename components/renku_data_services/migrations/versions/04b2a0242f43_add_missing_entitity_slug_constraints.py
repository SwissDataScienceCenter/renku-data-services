"""add missing entitity slug constraints

Revision ID: 04b2a0242f43
Revises: c8061499b966
Create Date: 2025-08-22 16:34:20.530644

"""

from alembic import op

# revision identifiers, used by Alembic.
revision = "04b2a0242f43"
down_revision = "c8061499b966"
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index(
        "entity_slugs_unique_slugs_data_connector_in_group_user_slugs",
        "entity_slugs",
        ["namespace_id", "data_connector_id", "slug"],
        unique=True,
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NULL",
    )
    op.create_index(
        "entity_slugs_unique_slugs_data_connector_in_project_slugs_1",
        "entity_slugs",
        ["namespace_id", "project_id", "slug"],
        unique=True,
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NOT NULL AND data_connector_id IS NOT NULL",
    )
    op.create_index(
        "entity_slugs_unique_slugs_data_connector_in_project_slugs_2",
        "entity_slugs",
        ["namespace_id", "data_connector_id", "slug"],
        unique=True,
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NOT NULL AND data_connector_id IS NOT NULL",
    )
    op.create_index(
        "entity_slugs_unique_slugs_project_slugs",
        "entity_slugs",
        ["namespace_id", "slug"],
        unique=True,
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="data_connector_id IS NULL",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        "entity_slugs_unique_slugs_project_slugs",
        table_name="entity_slugs",
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="data_connector_id IS NULL",
    )
    op.drop_index(
        "entity_slugs_unique_slugs_data_connector_in_project_slugs_2",
        table_name="entity_slugs",
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NOT NULL AND data_connector_id IS NOT NULL",
    )
    op.drop_index(
        "entity_slugs_unique_slugs_data_connector_in_project_slugs_1",
        table_name="entity_slugs",
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NOT NULL AND data_connector_id IS NOT NULL",
    )
    op.drop_index(
        "entity_slugs_unique_slugs_data_connector_in_group_user_slugs",
        table_name="entity_slugs",
        schema="common",
        postgresql_nulls_not_distinct=True,
        postgresql_where="project_id IS NULL",
    )
    # ### end Alembic commands ###
