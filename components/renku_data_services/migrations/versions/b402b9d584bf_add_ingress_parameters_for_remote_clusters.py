"""Add ingress parameters for remote clusters

Revision ID: b402b9d584bf
Revises: fe3b7470d226
Create Date: 2025-06-20 11:05:22.238236

"""

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "b402b9d584bf"
down_revision = "fe3b7470d226"
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "clusters", sa.Column("session_protocol", sa.String(length=10), nullable=False), schema="resource_pools"
    )
    op.add_column("clusters", sa.Column("session_host", sa.String(length=256), nullable=False), schema="resource_pools")
    op.add_column("clusters", sa.Column("session_port", sa.Integer(), nullable=False), schema="resource_pools")
    op.add_column("clusters", sa.Column("session_path", sa.String(), nullable=False), schema="resource_pools")
    op.add_column(
        "clusters",
        sa.Column(
            "session_ingress_annotations",
            sa.JSON().with_variant(postgresql.JSONB(astext_type=sa.Text()), "postgresql"),
            nullable=False,
        ),
        schema="resource_pools",
    )
    op.add_column(
        "clusters", sa.Column("session_tls_secret_name", sa.String(length=256), nullable=False), schema="resource_pools"
    )
    op.add_column(
        "clusters", sa.Column("session_storage_class", sa.String(length=256), nullable=True), schema="resource_pools"
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column("clusters", "session_storage_class", schema="resource_pools")
    op.drop_column("clusters", "session_tls_secret_name", schema="resource_pools")
    op.drop_column("clusters", "session_ingress_annotations", schema="resource_pools")
    op.drop_column("clusters", "session_path", schema="resource_pools")
    op.drop_column("clusters", "session_port", schema="resource_pools")
    op.drop_column("clusters", "session_host", schema="resource_pools")
    op.drop_column("clusters", "session_protocol", schema="resource_pools")
    # ### end Alembic commands ###
