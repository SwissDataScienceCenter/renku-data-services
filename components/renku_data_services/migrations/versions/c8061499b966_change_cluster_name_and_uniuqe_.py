"""change cluster name and uniuqe constraint

Revision ID: c8061499b966
Revises: e117405fed51
Create Date: 2025-08-14 07:40:10.492620

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "c8061499b966"
down_revision = "e117405fed51"
branch_labels = None
depends_on = None


def upgrade() -> None:
    op.execute(
        sa.text(
            "UPDATE common.k8s_objects SET cluster='0RENK1RENK2RENK3RENK4RENK5' where k8s_objects.cluster='renkulab'"
        )
    )
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index("ix_common_k8s_objects_name", table_name="k8s_objects", schema="common")
    op.create_index(op.f("ix_common_k8s_objects_name"), "k8s_objects", ["name"], unique=False, schema="common")
    op.create_unique_constraint(
        "_unique_common_k8s_objects_gvk_cluster_namespace_name",
        "k8s_objects",
        ["group", "version", "kind", "cluster", "namespace", "name"],
        schema="common",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(
        "_unique_common_k8s_objects_gvk_cluster_namespace_name", "k8s_objects", schema="common", type_="unique"
    )
    op.drop_index(op.f("ix_common_k8s_objects_name"), table_name="k8s_objects", schema="common")
    op.create_index("ix_common_k8s_objects_name", "k8s_objects", ["name"], unique=True, schema="common")
    # ### end Alembic commands ###
